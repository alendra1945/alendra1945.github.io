import{j as x,F as T,L as h}from"./index-AxBFuKLQ.js";import{j as w,o as H,s as d,a as S,t as v,u as M,i as b,c as u,F as E,k as O,ai as f,aj as j}from"./index-JAmVxnob.js";import{u as z,L as R}from"./pdf-annotate-try-D_YtBEhV.js";import"./container-CnLAr4hP.js";import"./animate.es-BYH7EM2J.js";import"./velocity.es-CI47LKMS.js";import"./index-BKcg2Qs7.js";import"./use-local-storage-Dn1wHuvy.js";var A=v('<svg><foreignObject class=drop-shadow-md x=0 y=0><div class="h-full w-full gp-2 rounded-xl"><div class="h-full w-full cursor-text outline-none font-normal"></svg>',!1,!0);function B(t){const e=document.createTextNode("");t.appendChild(e);const r=document.activeElement===t;if(e!==null&&e.nodeValue!==null&&r){r||t.focus();var o=window.getSelection();if(o!==null){var n=document.createRange();n.setStart(e,e.nodeValue.length),n.collapse(!0),o.removeAllRanges(),o.addRange(n)}t instanceof HTMLDivElement&&t.focus()}}const I=t=>{const[e,{setLayerState:r,history:o}]=z();let n;const s=t.layer.value||"text",y=(a,g)=>{const l=g*.5,m=a*.5;return Math.min(l,m,96)};H(()=>{const a=n;a&&(a!=null&&a.innerHTML&&s!==(a==null?void 0:a.innerHTML)&&(a.innerHTML=T(s)),a.focus(),B(a))});const c=a=>{const g=n;if(!g)return;const i=g.innerHTML;o.pause(),i!==s&&r(["layers",t.id,"value"],T(i)),o.resume()};return(()=>{var a=A(),g=a.firstChild,i=g.firstChild;a.$$pointerdown=l=>t.onPointerDown(l,t.id),i.$$pointerdown=l=>{e.layersState.selectionLayerIds.indexOf(t.id)!==-1&&l.stopPropagation()},i.$$keydown=c,i.$$keyup=c,i.addEventListener("blur",c),i.$$input=c;var $=n;return typeof $=="function"?M($,i):n=i,d(i,"spellcheck",!1),S(l=>{var m=`translate(${t.layer.x}px, ${t.layer.y}px)`,D=t.layer.width,k=t.layer.height,F=e.layersState.selectionLayerIds.indexOf(t.id)!==-1,L=`${y(t.layer.width,t.layer.height)}px`,C=t.layer.fill?x(t.layer.fill):"#000";return m!==l.e&&((l.e=m)!=null?a.style.setProperty("transform",m):a.style.removeProperty("transform")),D!==l.t&&d(a,"width",l.t=D),k!==l.a&&d(a,"height",l.a=k),F!==l.o&&d(i,"contenteditable",l.o=F),L!==l.i&&((l.i=L)!=null?i.style.setProperty("font-size",L):i.style.removeProperty("font-size")),C!==l.n&&((l.n=C)!=null?i.style.setProperty("color",C):i.style.removeProperty("color")),l},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),a})()};w(["pointerdown","input","keyup","keydown"]);var V=v("<svg><g></svg>",!1,!0),N=v("<svg><rect x=0 y=0 stroke-width=0></svg>",!1,!0);const W=t=>(()=>{var e=V();return e.$$pointerdown=r=>t.onPointerDown(r,t.id),b(e,u(E,{get each(){return t.layer.rects},children:r=>(()=>{var o=N();return S(n=>{var s=`translate(${r.x}px, ${r.y}px)`,y=r.width,c=r.height,a=t.layer.fill?x(t.layer.fill):"#000";return s!==n.e&&((n.e=s)!=null?o.style.setProperty("transform",s):o.style.removeProperty("transform")),y!==n.t&&d(o,"width",n.t=y),c!==n.a&&d(o,"height",n.a=c),a!==n.o&&d(o,"fill",n.o=a),n},{e:void 0,t:void 0,a:void 0,o:void 0}),o})()})),e})();w(["pointerdown"]);var q=v('<svg><foreignObject class="drop-shadow-md relative z-[3]"x=0 y=0></svg>',!1,!0);const G=t=>(()=>{var e=q();return e.$$pointerdown=r=>t.onPointerDown(r,t.id),S(r=>{var o=`translate(${t.layer.x}px, ${t.layer.y}px)`,n=t.layer.width,s=t.layer.height;return o!==r.e&&((r.e=o)!=null?e.style.setProperty("transform",o):e.style.removeProperty("transform")),n!==r.t&&d(e,"width",r.t=n),s!==r.a&&d(e,"height",r.a=s),r},{e:void 0,t:void 0,a:void 0}),e})();w(["pointerdown"]);var J=v('<svg><rect class="drop-shadow-md stroke-2"x=0 y=0 stroke-width=2></svg>',!1,!0);const K=t=>(()=>{var e=J();return e.$$pointerdown=r=>t.onPointerDown(r,t.id),e.style.setProperty("fill","transparent"),S(r=>{var o=`translate(${t.layer.x}px, ${t.layer.y}px)`,n=t.layer.width,s=t.layer.height,y=x(t.layer.fill);return o!==r.e&&((r.e=o)!=null?e.style.setProperty("transform",o):e.style.removeProperty("transform")),n!==r.t&&d(e,"width",r.t=n),s!==r.a&&d(e,"height",r.a=s),y!==r.o&&d(e,"stroke",r.o=y),r},{e:void 0,t:void 0,a:void 0,o:void 0}),e})();w(["pointerdown"]);var Q=v('<svg><foreignObject class=drop-shadow-md x=0 y=0><img class="full w-full p-2 rounded-xl"></svg>',!1,!0);const U=t=>(()=>{var e=Q(),r=e.firstChild;return e.$$pointerdown=o=>t.onPointerDown(o,t.id),S(o=>{var n=`translate(${t.layer.x}px, ${t.layer.y}px)`,s=t.layer.width,y=t.layer.height,c=t.layer.value;return n!==o.e&&((o.e=n)!=null?e.style.setProperty("transform",n):e.style.removeProperty("transform")),s!==o.t&&d(e,"width",o.t=s),y!==o.a&&d(e,"height",o.a=y),c!==o.o&&d(r,"src",o.o=c),o},{e:void 0,t:void 0,a:void 0,o:void 0}),e})();w(["pointerdown"]);const nt=t=>{var o;const[e]=z(),r=O(()=>e.layersState.layers[t.id],[(o=e.layersState.layers[t.id])==null?void 0:o.type]);return u(j,{fallback:[],get children(){return[u(f,{get when(){var n;return((n=r())==null?void 0:n.type)===h.Text},get children(){return u(I,{get id(){return t.id},get layer(){return e.layersState.layers[t.id]},get onPointerDown(){return t.onLayerPointerDown},get selectionColor(){return t.selectionColor}})}}),u(f,{get when(){var n;return((n=r())==null?void 0:n.type)===h.Highlight},get children(){return u(W,{get id(){return t.id},get layer(){return e.layersState.layers[t.id]},get onPointerDown(){return t.onLayerPointerDown},get selectionColor(){return t.selectionColor}})}}),u(f,{get when(){var n;return((n=r())==null?void 0:n.type)===h.Comment},get children(){return u(G,{get id(){return t.id},get layer(){return e.layersState.layers[t.id]},get onPointerDown(){return t.onLayerPointerDown},get selectionColor(){return t.selectionColor}})}}),u(f,{get when(){var n;return((n=r())==null?void 0:n.type)===h.Rectangle},get children(){return u(K,{get id(){return t.id},get layer(){return e.layersState.layers[t.id]},get onPointerDown(){return t.onLayerPointerDown},get selectionColor(){return t.selectionColor}})}}),u(f,{get when(){var n;return((n=r())==null?void 0:n.type)===h.Sticker},get children(){return u(U,{get id(){return t.id},get layer(){return e.layersState.layers[t.id]},get onPointerDown(){return t.onLayerPointerDown},get selectionColor(){return t.selectionColor}})}}),u(f,{get when(){var n;return((n=r())==null?void 0:n.type)===h.Path},get children(){return u(R,{get x(){return e.layersState.layers[t.id].x},get y(){return e.layersState.layers[t.id].y},get points(){return e.layersState.layers[t.id].points},get fill(){return x(e.layersState.layers[t.id].fill)},onPointerDown:n=>t.onLayerPointerDown(n,t.id),get stroke(){return x(e.layersState.layers[t.id].fill)}})}})]}})};export{nt as default};
